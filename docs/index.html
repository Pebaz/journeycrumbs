<!DOCTYPE html>
<html>

<head>
    <script name="lib-templates">
        const DEFAULT_PAGE = "main";
        var current_page = DEFAULT_PAGE;  // Needed to hide pages when switching

        function assert(condition, message = 'Assertion failed') {
            if (!condition) {
                throw new Error(message);
            }
        }

        function get_templates() {
            var template_elements = document.querySelectorAll(
                '[data-template]'
            );

            var templates = {};
            template_elements.forEach(element => {
                templates[element.dataset.template] = element;
            });

            return templates;
        }

        function instantiate_template(template_id) {
            var template = get_templates()[template_id];
            assert(template, `Invalid template name: ${template_id}`);

            // TODO(pbz): Since templates are instantiated at runtime, should
            // TODO(pbz): the name of the new instance be changed to "instance"?

            // Templates can have a "brain" class
            if (template.dataset.model != undefined) {
                // Get global variable by string name
                var model_class = eval(template.dataset.model);

                // Adding arbitrary property
                template.model_instance = new model_class(template);
                template.model_instance.init();
            }

            return template.cloneNode(true);
        }

        function render_templates() {
            var instances = document.querySelectorAll('[data-instance]');

            instances.forEach(element => {
                var template_name = element.dataset.instance;
                var instantiated_template = instantiate_template(template_name);
                show(instantiated_template);
                var parent = element.parentElement;
                parent.replaceChild(instantiated_template, element);
            });
        }

        function show(element) {
            element.removeAttribute('hidden');
        }

        function hide(element) {
            element.setAttribute('hidden', null);
        }

        function switch_page(name) {
            function get_pages() {
                var page_elements = document.querySelectorAll(
                    '[data-page]'
                );

                var pages = {};
                page_elements.forEach(
                    element => pages[element.dataset.page] = element
                );

                return pages;
            }

            var pages = get_pages();

            hide(pages[current_page]);
            current_page = name;
            show(pages[name]);
        }

        window.onload = function initialize() {
            switch_page(current_page);
            render_templates();
        };

        class Model {
            constructor(self) {
                this.self = self;
            }

            init() { }

            // Usage: get_child_element_by_attribute(element, 'id', 'variable-foo')
            get_child_element_by_attribute(attr, value) {
                return this.self.querySelector(`[${attr}="${value}"]`);
            }
        }
    </script>
    <style>
        input[type="text"] {
            width: 100%;
            height: 100%;
            border-radius: 5pt;
        }

        .vertical-box {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            row-gap: 16px;
            width: 100%;
            /* background-color: aqua; */
        }

        .generation-box {
            display: flex;
            width: 100%;
            /* background-color: blue; */
            height: 48px;
        }

        .horizontal-box {
            display: flex;
            justify-content: flex-start;
            column-gap: 10%;
            width: 100%;
        }

        .row-item {
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
            align-items: center;
            height: 48px;
        }

        /* The order matters for these media queries: */
        @media (max-aspect-ratio: 3/4) {
            div {
                background: blue;
            }

            .horizontal-box {
                flex-direction: column;
                align-items: flex-start;
                /* background-color: chocolate; */
            }

            .row-item {
                /* background-color: beige; */
                width: 90%;
            }

            button {
                border-radius: 5pt;
                width: 100%;
            }
        }

        @media (min-aspect-ratio: 3/4) and (max-aspect-ratio: 1/1) {
            div {
                background: red;
            }

            .horizontal-box {
                flex-direction: column;
                align-items: flex-start;
                /* background-color: chocolate; */
            }

            .row-item {
                /* background-color: beige; */
                width: 90%;
            }

            button {
                border-radius: 5pt;
                width: 100%;
            }
        }

        @media (min-aspect-ratio: 1/1) and (max-aspect-ratio: 4/3) {
            div {
                background: green;
            }

            .horizontal-box {
                flex-direction: row;
                align-items: center;
                /* background-color: chocolate; */
            }

            .row-item {
                /* background-color: beige; */
                width: 40%;
            }

            button {
                border-radius: 5pt;
                width: 14%;
            }
        }

        @media (min-aspect-ratio: 4/3) {
            div {
                background: yellow;
            }

            .horizontal-box {
                flex-direction: row;
                align-items: center;
                /* background-color: chocolate; */
            }

            .row-item {
                /* background-color: beige; */
                width: 40%;
            }

            button {
                border-radius: 5pt;
                width: 14%;
            }
        }
    </style>
    <script name="app">

    </script>
</head>

<body>
    <!-- Main Page -->
    <div data-page="main">
        <div class="vertical-box" id="crumbs">
            <div class="horizontal-box">
                <div class="generation-box">
                    <button onclick="new_crumb()">New Crumb</button>
                    <button onclick="update_journey()">Generate</button>
                </div>
            </div>
            <div>
                <label for="fragment-size">Fragment Size</label>
                <progress id="fragment-size" value="0" max="1"></progress>
            </div>
            <div class="horizontal-box" id="journey-crumb">
                <div class="row-item">
                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="48" height="48" viewBox="0 0 48 48">
                        <path fill="#90caf9"
                            d="M37,46H17c-3.3,0-6-2.7-6-6V20c0-3.3,2.7-6,6-6h20c3.3,0,6,2.7,6,6v20C43,43.3,40.3,46,37,46z">
                        </path>
                        <path fill="none" stroke="#18193f" stroke-linecap="round" stroke-linejoin="round"
                            stroke-miterlimit="10" stroke-width="3" d="M6.5,20.5v-5c0-3.3,2.7-6,6-6h10"></path>
                        <path fill="none" stroke="#18193f" stroke-linecap="round" stroke-linejoin="round"
                            stroke-miterlimit="10" stroke-width="3"
                            d="M38.5,25.5v10c0,3.3-2.7,6-6,6h-20c-3.3,0-6-2.7-6-6v-7"></path>
                        <line x1="23.5" x2="41.5" y1="24.5" y2="6.5" fill="none" stroke="#18193f" stroke-linecap="round"
                            stroke-linejoin="round" stroke-miterlimit="10" stroke-width="3"></line>
                        <polyline fill="none" stroke="#18193f" stroke-linecap="round" stroke-linejoin="round"
                            stroke-miterlimit="10" stroke-width="3" points="27.5,6.5 41.5,6.5 41.5,20.5"></polyline>
                    </svg>
                    <input type="text" name="crumb-url" placeholder="URL" oninput="update_size()"
                        style="border-radius: 5pt">
                </div>
                <div class="row-item">
                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="48" height="48" viewBox="0 0 48 48">
                        <circle cx="28" cy="28" r="18.5" fill="#90caf9"></circle>
                        <path fill="none" stroke="#18193f" stroke-linecap="round" stroke-linejoin="round"
                            stroke-miterlimit="10" stroke-width="3"
                            d="M31.4,41c-2.3,1-4.8,1.5-7.4,1.5C13.8,42.5,5.5,34.2,5.5,24c0-4.5,1.6-8.6,4.2-11.8"></path>
                        <path fill="none" stroke="#18193f" stroke-linecap="round" stroke-linejoin="round"
                            stroke-miterlimit="10" stroke-width="3"
                            d="M16.3,7.2c2.3-1.1,5-1.7,7.7-1.7c10.2,0,18.5,8.3,18.5,18.5c0,4-1.3,7.7-3.4,10.7"></path>
                        <circle cx="24" cy="16" r="2" fill="#18193f"></circle>
                        <line x1="24" x2="24" y1="22.5" y2="33.5" fill="none" stroke="#18193f" stroke-linecap="round"
                            stroke-miterlimit="10" stroke-width="3"></line>
                    </svg>
                    <input type="text" name="crumb-desc" placeholder="Description" oninput="update_size()"
                        style="border-radius: 5pt">
                </div>
            </div>
        </div>
    </div>
</body>

</html>