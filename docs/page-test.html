<html>

<head>
    <script>
        const DEFAULT_PAGE = "page-main";
        var current_page = DEFAULT_PAGE;  // Needed to hide pages when switching
    </script>
    <script>
        // Only call on page load. Subsequent calls will return instantiated
        // templates after `render_templates()` is called.
        function get_templates() {
            var template_elements = document.querySelectorAll(
                '[id^="template-"]'
            );

            var templates = {};
            template_elements.forEach(element => {
                templates[element.id] = element;
            });

            return templates;
        }

        // Template instantiation only happens once so it shouldn't matter if
        // subsequent calls to `get_templates()` return the instantiated
        // templates
        function render_templates() {
            function instantiate_template(template_id) {
                var template = get_templates()[template_id];
                return template.cloneNode(true);
            }

            var instances = document.querySelectorAll('[name^="instance-"]');

            instances.forEach(element => {
                var node_name = element.getAttribute('name');
                var template_name = node_name.replace('instance-', 'template-');
                var instantiated_template = instantiate_template(template_name);
                show(instantiated_template);
                var parent = element.parentElement;
                parent.replaceChild(instantiated_template, element);
            });
        }

        function show(element) {
            element.removeAttribute('hidden');
        }

        function hide(element) {
            element.setAttribute('hidden', null);
        }

        function switch_page(name) {
            function get_page_templates() {
                var page_template_elements = document.querySelectorAll(
                    '[id^="page-"]'
                );

                var page_templates = {};
                page_template_elements.forEach(element => {
                    page_templates[element.id] = element;
                });

                return page_templates;
            }

            var pages = get_page_templates();

            hide(pages[current_page]);
            current_page = name;
            show(pages[name]);
        }

        window.onload = function initialize() {
            switch_page(current_page);
            render_templates();
        };
    </script>
</head>

<body>
    Content

    <!-- Pages are not templates. They are just hidden until needed. -->
    <div hidden id="page-main">
        <style>
            #page-main p {
                margin: 1em 0;
                color: #900;
            }

            #page-main em {
                color: #900;
            }
        </style>
        <p>Some content here... </p>
        <div name="instance-external-link"></div>
    </div>

    <div hidden id="page-editor">
        <style>
            #page-editor p {
                margin: 1em 0;
                color: #900;
            }

            #page-editor em {
                color: #900;
            }
        </style>
        <a href="https://www.google.com">https://www.google.com</a>
        <div name="instance-external-link"></div>
    </div>

    <p>➡️Some other content⬅️</p>
    <div name="instance-external-link"></div>

    <!-- Templates can be instanced to prevent code duplication -->
    <div hidden id="template-external-link">
        <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="48" height="48" viewBox="0 0 48 48">
            <path fill="#90caf9"
                d="M37,46H17c-3.3,0-6-2.7-6-6V20c0-3.3,2.7-6,6-6h20c3.3,0,6,2.7,6,6v20C43,43.3,40.3,46,37,46z">
            </path>
            <path fill="none" stroke="#18193f" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10"
                stroke-width="3" d="M6.5,20.5v-5c0-3.3,2.7-6,6-6h10"></path>
            <path fill="none" stroke="#18193f" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10"
                stroke-width="3" d="M38.5,25.5v10c0,3.3-2.7,6-6,6h-20c-3.3,0-6-2.7-6-6v-7"></path>
            <line x1="23.5" x2="41.5" y1="24.5" y2="6.5" fill="none" stroke="#18193f" stroke-linecap="round"
                stroke-linejoin="round" stroke-miterlimit="10" stroke-width="3"></line>
            <polyline fill="none" stroke="#18193f" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10"
                stroke-width="3" points="27.5,6.5 41.5,6.5 41.5,20.5"></polyline>
        </svg>
    </div>
</body>

</html>